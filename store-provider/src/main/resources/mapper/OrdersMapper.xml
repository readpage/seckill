<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.mapper.OrdersMapper">
    <resultMap id="orderMap" type="Orders">
        <id property="id" column="id"/>
        <result property="create_date" column="create_date"/>
        <result property="pay_date" column="pay_date"/>
        <result property="status" column="status"/>
        <collection property="goods" ofType="Goods">
            <result property="name" column="name"/>
            <result property="price" column="price"/>
        </collection>
        <collection property="user" ofType="User">
            <result property="username" column="username"/>
        </collection>
    </resultMap>
    <select id="selectAll" resultMap="orderMap">
        SELECT o.id, o.create_date, o.pay_date, o.status,
        g.name, g.price, u.username
        FROM orders o, goods g, user u
        WHERE o.gid=g.id AND o.uid=u.id
    </select>
    <select id="findById" resultMap="orderMap">
        SELECT o.id, o.create_date, o.pay_date, o.status,
        g.name, g.price, u.username
        FROM orders o, goods g, user u
        WHERE o.gid=g.id AND o.uid=u.id
        AND o.id=#{id}
    </select>
    <delete id="deleteById" parameterType="Integer">
        DELETE FROM orders WHERE id=#{id}
    </delete>
    <update id="updateById" parameterType="Orders">
        UPDATE orders SET create_date=#{create_date},
            pay_date=#{pay_date}, status=#{status}
            WHERE id=#{id}
    </update>
    <insert id="add" parameterType="Orders">
        INSERT INTO orders(create_date, pay_date, status)
        VALUES(#{create_date}, #{pay_date}, #{status})
    </insert>
</mapper>